package aigent:host;

/// Parameters passed to a tool invocation.
record tool-param {
  name: string,
  value: string,
}

/// Result returned by a tool execution.
record tool-result {
  success: bool,
  output: string,
}

/// Metadata describing a tool.
record tool-spec {
  name: string,
  description: string,
}

world host {
  // ── logging & time ──────────────────────────────────────────
  export log: func(message: string);
  export get-time-unix-ms: func() -> u64;

  // ── filesystem (workspace-bounded) ──────────────────────────
  export read-file: func(path: string, max-bytes: u32) -> result<string, string>;
  export write-file: func(path: string, content: string) -> result<_, string>;
  export list-dir: func(path: string) -> result<list<string>, string>;

  // ── shell execution ─────────────────────────────────────────
  export run-shell: func(command: string, timeout-ms: u32) -> tool-result;

  // ── key-value store (persistent across invocations) ─────────
  export kv-get: func(key: string) -> option<string>;
  export kv-set: func(key: string, value: string);

  // ── HTTP client ─────────────────────────────────────────────
  export http-get: func(url: string) -> result<string, string>;
  export http-post: func(url: string, body: string, content-type: string) -> result<string, string>;

  // ── Git integration ─────────────────────────────────────────
  /// Commit all staged changes in the workspace with a standard message.
  /// Returns the short SHA of the new commit on success.
  export git-commit: func(message: string) -> result<string, string>;
  /// Revert the most recent commit (git revert HEAD --no-edit).
  /// Returns a human-readable summary on success.
  export git-rollback-last: func() -> result<string, string>;
  /// Return the one-line summary of the most recent commit, or an error
  /// when the workspace has no commits.
  export git-log-last: func() -> result<string, string>;

  // ── gait — safe native git ─────────────────────────────────
  /// A structured git operation request for the gait tool.
  /// `action`: status | log | diff | commit | checkout | branch | reset |
  ///           clone | pull | push | fetch | ls-remote | show | blame |
  ///           tag | stash.
  /// `repo`: "workspace", "self", an absolute path, or a remote URL.
  record git-operation {
    action: string,
    repo: string,
    target-dir: option<string>,
    branch: option<string>,
    message: option<string>,
    paths: option<list<string>>,
    force: option<bool>,
  }
  /// Preferred git interface — enforces trust boundaries.
  /// Returns rich formatted output suitable for LLM reflection.
  export perform-gait: func(op: git-operation) -> result<string, string>;

  // ── Secrets store ────────────────────────────────────────────
  /// Read a named secret from the workspace .secrets/ directory.
  /// The host validates that the name is a safe filename component.
  export secret-get: func(name: string) -> result<string, string>;

  // ── Guest must implement ────────────────────────────────────
  import spec: func() -> tool-spec;
  import run: func(params: list<tool-param>) -> tool-result;
}
